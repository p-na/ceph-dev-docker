#!/bin/bash

cd /ceph/build
../src/vstart.sh -n $@
./bin/ceph mgr module enable prometheus

sleep 5
./bin/ceph mgr services

echo "Additional services (if started):"
echo "Grafana on http://localhost:3000"
echo "Prometheus on http://localhost:9090"

# Prepare RBD

ceph osd pool create rbd 1 replicated # Create default pool
ceph osd pool application enable rbd rbd # Set application to `rbd` for pool

ceph osd pool create rbd_pool 1 replicated # Create pool
ceph osd pool application enable rbd_pool rbd # Set application to `rbd` for pool

tmux new -d -s ceph -n 'Backend Reload' 'auto-reloadm' # Create new session, detached
tmux new-window -t ceph -n 'Frontend Rebuild' 'fe-run' # Add new window to session
tmux attach -t ceph # Attach to session
